{% extends "base.html" %}
{% block content %}
<section class="deck-editor-page">
  <!-- Page Header -->
  <div class="page-header deck-editor-header">
    <div class="deck-editor-title">
      <div class="deck-editor-badge">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
        </svg>
        Deck Editor
      </div>
      <h2>{{ deck.title }}</h2>
      <p class="muted">Style: {{ deck.card_style }} Â· Status: {{ deck.status }}</p>
      <div class="deck-editor-summary">
        <span class="pill">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            style="margin-right: 4px;">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <line x1="9" y1="3" x2="9" y2="21" />
          </svg>
          {{ cards|length }} shown
        </span>
        <span class="pill">{{ deck.cards|length }} total</span>
        {% if q or card_type or status %}
        <span class="pill warn">Filtered</span>
        {% endif %}
      </div>
    </div>
    <div class="deck-editor-actions">
      <a class="btn ghost" href="{{ url_for('main.decks') }}">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        Back
      </a>
      <form action="{{ url_for('main.export_deck', deck_id=deck.id) }}" method="post">
        <button class="btn primary" type="submit">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="7 10 12 15 17 10" />
            <line x1="12" y1="15" x2="12" y2="3" />
          </svg>
          Export .apkg
        </button>
      </form>
    </div>
  </div>

  <!-- Filter Panel -->
  <section class="panel editor-filter-panel">
    <div class="filter-header">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polygon points="22 3 2 3 10 12.5 10 19 14 21 14 12.5 22 3" />
      </svg>
      <span>Filter Cards</span>
    </div>
    <form method="get" class="editor-filter-form">
      <div class="filter-input-group">
        <label for="filter-q">Search</label>
        <input type="text" id="filter-q" name="q" value="{{ q }}" placeholder="Search cards...">
      </div>
      <div class="filter-input-group">
        <label for="filter-type">Type</label>
        <select id="filter-type" name="type">
          <option value="">All types</option>
          <option value="basic" {% if card_type=="basic" %}selected{% endif %}>Basic</option>
          <option value="cloze" {% if card_type=="cloze" %}selected{% endif %}>Cloze</option>
        </select>
      </div>
      <div class="filter-input-group">
        <label for="filter-status">Status</label>
        <select id="filter-status" name="status">
          <option value="">All status</option>
          <option value="ok" {% if status=="ok" %}selected{% endif %}>OK</option>
          <option value="needs_review" {% if status=="needs_review" %}selected{% endif %}>Needs review</option>
          <option value="deleted" {% if status=="deleted" %}selected{% endif %}>Deleted</option>
        </select>
      </div>
      <div class="filter-actions">
        <button class="btn ghost" type="submit">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
          Apply
        </button>
        {% if q or card_type or status %}
        <a class="btn ghost" href="{{ url_for('main.deck_editor', deck_id=deck.id) }}">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
          Clear
        </a>
        {% endif %}
      </div>
    </form>
  </section>

  <!-- Bulk Actions Panel -->
  <form action="{{ url_for('main.bulk_cards') }}" method="post" class="panel editor-bulk-panel" id="bulk-actions-form">
    <div class="bulk-header">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
        <path d="M9 12l2 2 4-4" />
      </svg>
      <span>Bulk Actions</span>
    </div>
    <div class="editor-bulk-row">
      <select name="action">
        <option value="delete">Delete selected</option>
        <option value="restore">Restore selected</option>
        <option value="tag">Add tag</option>
        <option value="regenerate">Regenerate from source</option>
      </select>
      <input type="text" name="tag" placeholder="Tag name (for add tag)">
      <button class="btn ghost" type="submit">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M5 12h14M12 5l7 7-7 7" />
        </svg>
        Apply
      </button>
    </div>
  </form>

  <!-- Cards Table -->
  <section class="panel editor-table-panel">
    {% if cards %}
    <div class="table cards-table">
      <div class="table-row table-head">
        <div class="col-select">
          <input type="checkbox" id="select-all" aria-label="Select all cards">
        </div>
        <div>Card Content</div>
        <div>Tags</div>
        <div>Type</div>
      </div>
      {% for card in cards %}
      {% include "partials/card_row.html" %}
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <div class="empty-icon">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
          <line x1="9" y1="3" x2="9" y2="21" />
        </svg>
      </div>
      <h3>No cards found</h3>
      <p>{% if q or card_type or status %}Try adjusting your filters.{% else %}This deck doesn't have any cards yet.{%
        endif %}</p>
    </div>
    {% endif %}
  </section>
</section>

<style>
  /* Deck Editor Badge */
  .deck-editor-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: var(--accent-muted);
    border: 1px solid rgba(255, 107, 107, 0.25);
    border-radius: 100px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: var(--space-md);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  /* Filter Panel */
  .filter-header {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--space-lg);
  }

  .filter-header svg {
    color: var(--accent);
  }

  .editor-filter-form {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr auto;
    gap: var(--space-md);
    align-items: end;
  }

  .filter-input-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .filter-input-group label {
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-tertiary);
    margin: 0;
  }

  .filter-actions {
    display: flex;
    gap: var(--space-sm);
  }

  /* Bulk Actions Panel */
  .editor-bulk-panel {
    padding: var(--space-md) var(--space-lg);
    background: rgba(255, 255, 255, 0.02);
  }

  .bulk-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-tertiary);
    margin-bottom: var(--space-md);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .editor-bulk-row {
    display: flex;
    gap: var(--space-md);
    align-items: center;
    flex-wrap: wrap;
  }

  .editor-bulk-row select,
  .editor-bulk-row input {
    flex: 1;
    min-width: 140px;
    max-width: 220px;
  }

  /* Cards Table */
  .editor-table-panel {
    padding: 0;
    overflow: hidden;
  }

  .cards-table .table-row {
    grid-template-columns: 48px 1fr 180px 120px;
    padding: var(--space-lg);
  }

  .cards-table .table-head {
    padding: var(--space-md) var(--space-lg);
  }

  .col-select {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .col-select input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--accent);
    cursor: pointer;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
  }

  .empty-state .empty-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 80px;
    height: 80px;
    background: var(--bg-elevated);
    border-radius: 20px;
    color: var(--text-tertiary);
    margin-bottom: var(--space-lg);
  }

  .empty-state h3 {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: var(--space-sm);
    color: var(--text-primary);
  }

  .empty-state p {
    color: var(--text-tertiary);
    font-size: 0.9rem;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .editor-filter-form {
      grid-template-columns: 1fr 1fr;
    }

    .filter-actions {
      grid-column: 1 / -1;
    }
  }

  @media (max-width: 600px) {
    .editor-filter-form {
      grid-template-columns: 1fr;
    }

    .cards-table .table-row {
      grid-template-columns: 40px 1fr auto;
    }

    .cards-table .table-head div:nth-child(3) {
      display: none;
    }

    .cards-table .card-row .card-tags {
      display: none;
    }
  }
</style>

<script>
  // Select all checkbox functionality
  document.getElementById('select-all')?.addEventListener('change', function () {
    const checkboxes = document.querySelectorAll('input[name="card_ids"]');
    checkboxes.forEach(cb => cb.checked = this.checked);
  });
</script>
{% endblock %}