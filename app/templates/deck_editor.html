{% extends "base.html" %}
{% block content %}
<section class="deck-editor-page">
  <div class="page-header deck-editor-header">
    <div class="deck-editor-title">
      <h2>{{ deck.title }}</h2>
      <p class="muted">Style: {{ deck.card_style }} &middot; Status: {{ deck.status }}</p>
      <div class="deck-editor-summary">
        <span class="pill">{{ cards|length }} shown</span>
        <span class="pill">{{ deck.cards|length }} total</span>
        {% if q or card_type or status %}
        <span class="pill warn">Filtered</span>
        {% endif %}
      </div>
    </div>
    <div class="deck-editor-actions">
      <form action="{{ url_for('main.export_deck', deck_id=deck.id) }}" method="post">
        <button class="btn primary" type="submit">Export .apkg</button>
      </form>
    </div>
  </div>

  <section class="panel editor-filter-panel">
    <form method="get" class="form inline editor-filter-form">
      <input type="text" name="q" value="{{ q }}" placeholder="Search cards">
      <select name="type">
        <option value="">All types</option>
        <option value="basic" {% if card_type=="basic" %}selected{% endif %}>Basic</option>
        <option value="cloze" {% if card_type=="cloze" %}selected{% endif %}>Cloze</option>
      </select>
      <select name="status">
        <option value="">All status</option>
        <option value="ok" {% if status=="ok" %}selected{% endif %}>OK</option>
        <option value="needs_review" {% if status=="needs_review" %}selected{% endif %}>Needs review</option>
        <option value="deleted" {% if status=="deleted" %}selected{% endif %}>Deleted</option>
      </select>
      <button class="btn ghost" type="submit">Apply filters</button>
      {% if q or card_type or status %}
      <a class="btn ghost" href="{{ url_for('main.deck_editor', deck_id=deck.id) }}">Clear</a>
      {% endif %}
    </form>
  </section>

  <form action="{{ url_for('main.bulk_cards') }}" method="post" class="panel editor-bulk-panel" id="bulk-actions-form">
    <div class="editor-bulk-row">
      <select name="action">
        <option value="delete">Delete</option>
        <option value="restore">Restore</option>
        <option value="tag">Add tag</option>
        <option value="regenerate">Regenerate from source</option>
      </select>
      <input type="text" name="tag" placeholder="Tag (for add tag)">
      <button class="btn ghost" type="submit">Apply</button>
    </div>
  </form>

  <section class="panel editor-table-panel">
    <div class="table cards-table">
      <div class="table-row table-head">
        <div></div>
        <div>Card</div>
        <div>Tags</div>
        <div>Type</div>
      </div>
      {% for card in cards %}
      {% include "partials/card_row.html" %}
      {% else %}
      <div class="empty">No cards yet.</div>
      {% endfor %}
    </div>
  </section>
</section>
{% endblock %}
