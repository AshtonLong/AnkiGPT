{% extends "base.html" %}
{% block content %}
<section class="status-page">
  <div class="panel status-panel">
    <!-- Icon -->
    <div
      class="status-icon {% if deck.status == 'ready' %}success{% elif deck.status == 'failed' %}error{% else %}processing{% endif %}">
      {% if deck.status == "ready" %}
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10" />
        <path d="m9 12 2 2 4-4" />
      </svg>
      {% elif deck.status == "failed" %}
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10" />
        <line x1="15" y1="9" x2="9" y2="15" />
        <line x1="9" y1="9" x2="15" y2="15" />
      </svg>
      {% else %}
      <svg class="spin" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12a9 9 0 1 1-6.219-8.56" />
      </svg>
      {% endif %}
    </div>

    <!-- Title -->
    <h2>
      {% if deck.status == "ready" %}
      Deck Ready!
      {% elif deck.status == "failed" %}
      Generation Failed
      {% else %}
      Generating Cards...
      {% endif %}
    </h2>

    <!-- Subtitle -->
    <p class="status-subtitle">{{ deck.title }}</p>

    <!-- Progress Bar -->
    {% if deck.status not in ["ready", "failed"] %}
    <div class="progress-wrapper">
      <div class="progress">
        <div class="bar" style="width: {{ 0 if total_sources == 0 else (done_sources / total_sources) * 100 }}%"></div>
      </div>
      <p class="progress-text">
        <span class="progress-count">{{ done_sources }}</span> / <span>{{ total_sources }}</span> chunks processed
      </p>
    </div>
    {% endif %}

    <!-- Status Message -->
    {% if deck.status == "ready" %}
    <div class="status-message success-message">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
        <polyline points="22 4 12 14.01 9 11.01" />
      </svg>
      Your flashcards are ready. Open the editor to review and export.
    </div>
    {% elif deck.status == "failed" %}
    <div class="status-message error-message">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="8" x2="12" y2="12" />
        <line x1="12" y1="16" x2="12.01" y2="16" />
      </svg>
      {{ failure_message }}
    </div>
    {% else %}
    <div class="status-message processing-message">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10" />
        <polyline points="12 6 12 12 16 14" />
      </svg>
      AI is processing your content. This usually takes 30-60 seconds.
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="status-actions">
      {% if deck.status == "ready" %}
      <a class="btn primary" href="{{ url_for('main.deck_editor', deck_id=deck.id) }}">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
          <path d="M18.5 2.5a2.1 2.1 0 0 1 3 3L12 15l-4 1 1-4Z" />
        </svg>
        Open Editor
      </a>
      <a class="btn ghost" href="{{ url_for('main.decks') }}">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
        </svg>
        All Decks
      </a>
      {% elif deck.status == "failed" %}
      <a class="btn primary" href="{{ url_for('main.new_deck') }}">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M12 5v14M5 12h14" />
        </svg>
        Try Again
      </a>
      <a class="btn ghost" href="{{ url_for('main.decks') }}">Back to Decks</a>
      {% else %}
      <a class="btn ghost refresh-btn" href="{{ url_for('main.status', deck_id=deck.id) }}">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 2v6h-6" />
          <path d="M3 12a9 9 0 0 1 15-6.7L21 8" />
          <path d="M3 22v-6h6" />
          <path d="M21 12a9 9 0 0 1-15 6.7L3 16" />
        </svg>
        Refresh
      </a>
      <a class="btn ghost" href="{{ url_for('main.decks') }}">Back to Decks</a>
      {% endif %}
    </div>
  </div>
</section>

<style>
  .status-page {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 60vh;
  }

  .status-panel {
    max-width: 480px;
    text-align: center;
    padding: 3rem 2.5rem;
  }

  /* Status Icon */
  .status-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 96px;
    height: 96px;
    border-radius: 24px;
    margin-bottom: var(--space-xl);
  }

  .status-icon.success {
    background: linear-gradient(135deg, rgba(107, 255, 158, 0.15), rgba(107, 255, 158, 0.05));
    color: var(--accent-tertiary);
  }

  .status-icon.error {
    background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), rgba(255, 107, 107, 0.05));
    color: var(--accent);
  }

  .status-icon.processing {
    background: linear-gradient(135deg, rgba(107, 181, 255, 0.15), rgba(192, 107, 255, 0.05));
    color: var(--accent-cool);
  }

  .spin {
    animation: spin 1.5s linear infinite;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }

    to {
      transform: rotate(360deg);
    }
  }

  /* Title */
  .status-panel h2 {
    font-family: var(--font-display);
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: var(--space-xs);
    background: linear-gradient(180deg, var(--text-primary) 0%, rgba(255, 255, 255, 0.8) 100%);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .status-subtitle {
    color: var(--text-tertiary);
    font-size: 0.95rem;
    margin-bottom: var(--space-xl);
  }

  /* Progress */
  .progress-wrapper {
    margin-bottom: var(--space-xl);
  }

  .progress {
    height: 10px;
    background: var(--bg-deep);
    border-radius: 100px;
    overflow: hidden;
    margin-bottom: var(--space-md);
  }

  .progress .bar {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent-secondary), var(--accent-tertiary));
    background-size: 200% 100%;
    animation: shimmer 2s ease-in-out infinite;
    border-radius: 100px;
    transition: width 0.5s var(--ease-out);
  }

  @keyframes shimmer {
    0% {
      background-position: 200% 0;
    }

    100% {
      background-position: -200% 0;
    }
  }

  .progress-text {
    font-size: 0.85rem;
    color: var(--text-tertiary);
  }

  .progress-count {
    font-weight: 600;
    color: var(--text-secondary);
  }

  /* Status Messages */
  .status-message {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: var(--space-md) var(--space-lg);
    border-radius: var(--radius-md);
    font-size: 0.9rem;
    margin-bottom: var(--space-xl);
  }

  .success-message {
    background: rgba(107, 255, 158, 0.08);
    border: 1px solid rgba(107, 255, 158, 0.2);
    color: var(--accent-tertiary);
  }

  .error-message {
    background: rgba(255, 107, 107, 0.08);
    border: 1px solid rgba(255, 107, 107, 0.2);
    color: var(--accent);
  }

  .processing-message {
    background: rgba(107, 181, 255, 0.08);
    border: 1px solid rgba(107, 181, 255, 0.2);
    color: var(--accent-cool);
  }

  /* Actions */
  .status-actions {
    display: flex;
    gap: var(--space-md);
    justify-content: center;
    flex-wrap: wrap;
  }

  .refresh-btn {
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: 0.7;
    }
  }
</style>

{% if deck.status not in ["ready", "failed"] %}
<script>
  // Auto-refresh every 3 seconds while processing
  setTimeout(function () {
    window.location.reload();
  }, 3000);
</script>
{% endif %}
{% endblock %}
